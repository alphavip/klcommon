<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>History</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="history">
<h1 class="title">History</h1>

<p>使用Lisp来开发博客系统，会发生很多趣事，在此偶尔记录。</p>
<p><strong>4.30.2011</strong></p>
<ul class="simple">
<li>增加留言功能，使用了评论功能的部分代码</li>
<li>修改rststyle.css，改代码块背景色为灰色</li>
<li>将主导航改为横向，由增加banner :after实现，主要还是通过css来控制</li>
<li>将搜索框改到主导航右侧，进一步给左侧导航留出空间</li>
<li>限制最新文章仅显示5篇</li>
<li>添加公告导航框</li>
</ul>
<p><strong>4.24.2011</strong></p>
<p>修正使用google搜索站内无内容的问题。 传给google的地址里，domains和sitesearch都包
含了域名，domains可以为任意标示，但是sitesearch则必须为codemacro.com。</p>
<p>到目前为止，主要功能基本都有了。服务器和SBCL都算稳定。</p>
<p><strong>4.23.2011</strong></p>
<p>现在没心思花在代码结构方面，一方面我不想以其他语言（C/C++）的模块组织方式去规划
Lisp，Lisp有自己的方式；另一方面基于不想修改nuclblog源代码的基础上增加功能，本身
就是个吃力不讨好的事情。索性，先完成功能。也许将来头一热，就自己重头写个。</p>
<ul class="simple">
<li>完成评论审核功能，加入后台评论管理，包括“删除评论“、”审核评论“</li>
<li>加入“最新评论“栏</li>
<li>修改了导航栏宽度，悲剧地修改了nuclblog的css文件</li>
<li>修改about页面直接使用博客文章</li>
<li>加入“统计“导航，方便查看是否有待验证留言</li>
</ul>
<p><strong>4.22.2011</strong></p>
<p>原始的nuclblog功能实在过于简陋，包括评论功能我都得自己写。关键是我对WEB前端完全无
经验更无多少积累。评论功能最麻烦的就是对垃圾信息的过滤，思来想去，还是直接人工审
核算了。</p>
<p>nuclblog在一开启的时候，就载入了所有的文章。这在内存如此有限的VPS上，实在是种
残酷。包括评论也一样。要节约内存，只有等需要显示的时候，才载入。一想头皮就发麻，
想想自己未来好长一段业余时间，都要扑在这个非主流语言的博客系统上，就为时间而痛心。</p>
<p>Anyway，今天依然把这个简朴的评论功能发上来。为了让人测试，直接不过滤了。</p>
<p><strong>4.20.2011</strong></p>
<p>目前ext-blog还存在很多BUG，或者说很多不完美的地方。所以目前这个博客网站也算是处
于测试阶段。现在上班期间干不了这事，所以只有晚上的几个小时能做。今天修正的问题包
括:</p>
<ul>
<li><p class="first">修正XMLRPC发布文章时分类不正确问题</p>
</li>
<li><p class="first">修正XMLRPC发布文章无法显示作者问题(session-realm-user其实返回的是验证过的用户名)</p>
</li>
<li><p class="first">修正XMLRPC调用metaweblog api时没有进行用户验证的问题(check-password)</p>
</li>
<li><p class="first">修正当文章数为单页显示数整数倍时，页数多计算一页的问题</p>
</li>
<li><p class="first">修正RSS中关于channel的link错误问题，因为目前hunchentoot使用了nginx作为代理服务
器，而nuclblog内部又是使用http request中的Host域来生成RSS channel link，所以就
会得到http://127.0.0.1:xxx之类的url。解决办法就是在nginx的配置里重新设置http请
求头中的Host:</p>
<pre class="literal-block">
# nginx configure
localtion / {
    proxy_set_header Host $host;
}
</pre>
</li>
<li><p class="first">增加virtual host，以正确响应不同域名请求，这个主要是nuclblog使用了virtual host
导致</p>
</li>
</ul>
<p><strong>4.19.2011</strong></p>
<p>使用SSH登录VPS，启动SBCL，然后在其交互模式下开启hucnhentoot。然后断开SSH后，SBCL
也会退出。解决方法可以简单地使用screen程序来完成，其具体原理暂时没时间去探究:</p>
<pre class="literal-block">
screen -D -m -S nucblog sbcl --eval &quot;(load \&quot;ext-blog/wrap-run.lisp\&quot;) --dynamic-space 90
</pre>
<p><strong>4.18.2011</strong></p>
<p>因为SBCL运行的OS貌似其locale不是utf8，所以SBCL在load包含中文的代码文件时，直接
报错，大概就是不可识别某个字符：external-format :asci。使用如下方式载入代码文件
是最简单直接的方法:</p>
<pre class="literal-block">
(load &quot;ext-blog/run.lisp&quot; :external-format :utf-8)
</pre>
<p><strong>4.17.2011</strong></p>
<p>VPS的内存非常有限，仅128M。网上关于SBCL运行于VPS上会出现的问题也非常多。似乎加上
一些显示的内存大小参数，可以解决问题，这个当然得有待实验:</p>
<pre class="literal-block">
#sbcl --dynamic-space 90
</pre>
<p>90M是我在本机上实验的最小数量，也许直接使用编译好的lisp文件可以减少此数值。</p>
</div>
</body>
</html>
